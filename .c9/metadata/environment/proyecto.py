{"filter":false,"title":"proyecto.py","tooltip":"/proyecto.py","undoManager":{"mark":39,"position":39,"stack":[[{"start":{"row":0,"column":0},"end":{"row":50,"column":5},"action":"insert","lines":["import json","import urllib.request","import boto3","from datetime import datetime","","# Configuración del bucket S3","S3_BUCKET = \"landing-casas-xxx\"","","# URL base de Mitula para apartaestudios en venta en Bogotá","BASE_URL = \"https://casas.mitula.com.co/apartaestudio/bogota/?page={}\"","","# Inicializar cliente S3","s3_client = boto3.client(\"s3\")","","def download_page(url):","    \"\"\"Descarga una página HTML y devuelve su contenido.\"\"\"","    try:","        with urllib.request.urlopen(url) as response:","            return response.read().decode(\"utf-8\")","    except Exception as e:","        print(f\"Error al descargar {url}: {e}\")","        return None","","def lambda_handler(event, context):","    today = datetime.utcnow().strftime(\"%Y-%m-%d\")","    ","    for page in range(1, 11):  # Descargar 10 páginas","        url = BASE_URL.format(page)","        print(f\"Descargando: {url}\")","","        html_content = download_page(url)","        if html_content:","            file_name = f\"{today}/page_{page}.html\"","            s3_key = f\"{file_name}\"","            ","            # Subir a S3","            try:","                s3_client.put_object(","                    Bucket=S3_BUCKET,","                    Key=s3_key,","                    Body=html_content,","                    ContentType=\"text/html\"","                )","                print(f\"Guardado en S3: s3://{S3_BUCKET}/{s3_key}\")","            except Exception as e:","                print(f\"Error al subir {file_name} a S3: {e}\")","","    return {","        \"statusCode\": 200,","        \"body\": json.dumps(\"Descarga y almacenamiento completados.\")","    }"],"id":212}],[{"start":{"row":6,"column":13},"end":{"row":6,"column":30},"action":"remove","lines":["landing-casas-xxx"],"id":213},{"start":{"row":6,"column":13},"end":{"row":6,"column":27},"action":"insert","lines":["paginaspruebas"]}],[{"start":{"row":14,"column":23},"end":{"row":15,"column":59},"action":"remove","lines":["","    \"\"\"Descarga una página HTML y devuelve su contenido.\"\"\""],"id":214}],[{"start":{"row":0,"column":0},"end":{"row":49,"column":5},"action":"remove","lines":["import json","import urllib.request","import boto3","from datetime import datetime","","# Configuración del bucket S3","S3_BUCKET = \"paginaspruebas\"","","# URL base de Mitula para apartaestudios en venta en Bogotá","BASE_URL = \"https://casas.mitula.com.co/apartaestudio/bogota/?page={}\"","","# Inicializar cliente S3","s3_client = boto3.client(\"s3\")","","def download_page(url):","    try:","        with urllib.request.urlopen(url) as response:","            return response.read().decode(\"utf-8\")","    except Exception as e:","        print(f\"Error al descargar {url}: {e}\")","        return None","","def lambda_handler(event, context):","    today = datetime.utcnow().strftime(\"%Y-%m-%d\")","    ","    for page in range(1, 11):  # Descargar 10 páginas","        url = BASE_URL.format(page)","        print(f\"Descargando: {url}\")","","        html_content = download_page(url)","        if html_content:","            file_name = f\"{today}/page_{page}.html\"","            s3_key = f\"{file_name}\"","            ","            # Subir a S3","            try:","                s3_client.put_object(","                    Bucket=S3_BUCKET,","                    Key=s3_key,","                    Body=html_content,","                    ContentType=\"text/html\"","                )","                print(f\"Guardado en S3: s3://{S3_BUCKET}/{s3_key}\")","            except Exception as e:","                print(f\"Error al subir {file_name} a S3: {e}\")","","    return {","        \"statusCode\": 200,","        \"body\": json.dumps(\"Descarga y almacenamiento completados.\")","    }"],"id":215},{"start":{"row":0,"column":0},"end":{"row":38,"column":0},"action":"insert","lines":["import json","import urllib.request","import boto3","from datetime import datetime","","def lambda_handler(event, context):","    # Configuración del bucket S3","    S3_BUCKET = \"paginaspruebas\"","    BASE_URL = \"https://casas.mitula.com.co/apartaestudio/bogota/?page={}\"","    s3_client = boto3.client(\"s3\")","    today = datetime.utcnow().strftime(\"%Y-%m-%d\")","    ","    for page in range(1, 11):  # Descargar 10 páginas","        url = BASE_URL.format(page)","        print(f\"Descargando: {url}\")","        ","        try:","            with urllib.request.urlopen(url) as response:","                html_content = response.read().decode(\"utf-8\")","                ","                file_name = f\"{today}/page_{page}.html\"","                s3_key = f\"{file_name}\"","                ","                # Subir a S3","                s3_client.put_object(","                    Bucket=S3_BUCKET,","                    Key=s3_key,","                    Body=html_content,","                    ContentType=\"text/html\"","                )","                print(f\"Guardado en S3: s3://{S3_BUCKET}/{s3_key}\")","        except Exception as e:","            print(f\"Error al procesar la página {page}: {e}\")","    ","    return {","        \"statusCode\": 200,","        \"body\": json.dumps(\"Descarga y almacenamiento completados.\")","    }",""]}],[{"start":{"row":6,"column":33},"end":{"row":7,"column":0},"action":"insert","lines":["",""],"id":216},{"start":{"row":7,"column":0},"end":{"row":7,"column":4},"action":"insert","lines":["    "]},{"start":{"row":7,"column":4},"end":{"row":8,"column":0},"action":"insert","lines":["",""]},{"start":{"row":8,"column":0},"end":{"row":8,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":8,"column":4},"end":{"row":12,"column":5},"action":"insert","lines":["    headers = {","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Referer\": \"https://www.google.com/\"","    }"],"id":217}],[{"start":{"row":12,"column":5},"end":{"row":13,"column":0},"action":"insert","lines":["",""],"id":218},{"start":{"row":13,"column":0},"end":{"row":13,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":8,"column":4},"end":{"row":8,"column":8},"action":"remove","lines":["    "],"id":219}],[{"start":{"row":35,"column":43},"end":{"row":35,"column":44},"action":"insert","lines":[","],"id":220}],[{"start":{"row":35,"column":44},"end":{"row":36,"column":0},"action":"insert","lines":["",""],"id":221},{"start":{"row":36,"column":0},"end":{"row":36,"column":20},"action":"insert","lines":["                    "]}],[{"start":{"row":36,"column":20},"end":{"row":36,"column":37},"action":"insert","lines":["ACL=\"public-read\""],"id":222}],[{"start":{"row":8,"column":4},"end":{"row":12,"column":5},"action":"remove","lines":["headers = {","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Referer\": \"https://www.google.com/\"","    }"],"id":223},{"start":{"row":8,"column":4},"end":{"row":16,"column":5},"action":"insert","lines":["headers = {","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36\",","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Referer\": \"https://www.google.com/\",","        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\",","        \"Cache-Control\": \"no-cache\",","        \"Pragma\": \"no-cache\",","        \"Connection\": \"keep-alive\"","    }"]}],[{"start":{"row":8,"column":4},"end":{"row":16,"column":5},"action":"remove","lines":["headers = {","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36\",","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Referer\": \"https://www.google.com/\",","        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\",","        \"Cache-Control\": \"no-cache\",","        \"Pragma\": \"no-cache\",","        \"Connection\": \"keep-alive\"","    }"],"id":224},{"start":{"row":8,"column":4},"end":{"row":17,"column":6},"action":"insert","lines":["session = requests.Session()","    session.headers.update({","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36\",","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Referer\": \"https://www.google.com/\",","        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\",","        \"Cache-Control\": \"no-cache\",","        \"Pragma\": \"no-cache\",","        \"Connection\": \"keep-alive\"","    })"]}],[{"start":{"row":8,"column":4},"end":{"row":17,"column":6},"action":"remove","lines":["session = requests.Session()","    session.headers.update({","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36\",","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Referer\": \"https://www.google.com/\",","        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\",","        \"Cache-Control\": \"no-cache\",","        \"Pragma\": \"no-cache\",","        \"Connection\": \"keep-alive\"","    })"],"id":225},{"start":{"row":8,"column":4},"end":{"row":10,"column":1},"action":"insert","lines":["headers = {","    \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36\"","}"]}],[{"start":{"row":10,"column":0},"end":{"row":10,"column":4},"action":"insert","lines":["    "],"id":226}],[{"start":{"row":17,"column":53},"end":{"row":18,"column":0},"action":"insert","lines":["",""],"id":227},{"start":{"row":18,"column":0},"end":{"row":18,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":18,"column":4},"end":{"row":18,"column":8},"action":"insert","lines":["    "],"id":228}],[{"start":{"row":18,"column":8},"end":{"row":18,"column":59},"action":"insert","lines":["response = requests.get(HTML_URL, headers=headers) "],"id":229}],[{"start":{"row":17,"column":53},"end":{"row":18,"column":59},"action":"remove","lines":["","        response = requests.get(HTML_URL, headers=headers) "],"id":230}],[{"start":{"row":8,"column":4},"end":{"row":10,"column":5},"action":"remove","lines":["headers = {","    \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36\"","    }"],"id":231},{"start":{"row":8,"column":4},"end":{"row":10,"column":5},"action":"insert","lines":["headers = {","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36\"","    }"]}],[{"start":{"row":33,"column":43},"end":{"row":34,"column":37},"action":"remove","lines":[",","                    ACL=\"public-read\""],"id":232}],[{"start":{"row":8,"column":4},"end":{"row":10,"column":5},"action":"remove","lines":["headers = {","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36\"","    }"],"id":233},{"start":{"row":8,"column":4},"end":{"row":17,"column":5},"action":"insert","lines":[" headers = {","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36\",","        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8\",","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Referer\": \"https://www.google.com/\",","        \"DNT\": \"1\",","        \"Connection\": \"keep-alive\",","        \"Upgrade-Insecure-Requests\": \"1\",","        \"Cookie\": \"your_cookie_here\"","    }"]}],[{"start":{"row":8,"column":4},"end":{"row":8,"column":5},"action":"remove","lines":[" "],"id":234}],[{"start":{"row":8,"column":4},"end":{"row":17,"column":5},"action":"remove","lines":["headers = {","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36\",","        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8\",","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Referer\": \"https://www.google.com/\",","        \"DNT\": \"1\",","        \"Connection\": \"keep-alive\",","        \"Upgrade-Insecure-Requests\": \"1\",","        \"Cookie\": \"your_cookie_here\"","    }"],"id":235},{"start":{"row":8,"column":4},"end":{"row":10,"column":1},"action":"insert","lines":["headers = {","    \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36\"","}"]}],[{"start":{"row":10,"column":0},"end":{"row":10,"column":4},"action":"insert","lines":["    "],"id":236}],[{"start":{"row":9,"column":4},"end":{"row":9,"column":8},"action":"insert","lines":["    "],"id":237}],[{"start":{"row":0,"column":11},"end":{"row":1,"column":21},"action":"remove","lines":["","import urllib.request"],"id":238},{"start":{"row":0,"column":11},"end":{"row":0,"column":12},"action":"insert","lines":["s"]}],[{"start":{"row":0,"column":0},"end":{"row":42,"column":0},"action":"remove","lines":["import jsons","import boto3","from datetime import datetime","","def lambda_handler(event, context):","    # Configuración del bucket S3","    ","    headers = {","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36\"","    }","    ","    S3_BUCKET = \"paginaspruebas\"","    BASE_URL = \"https://casas.mitula.com.co/apartaestudio/bogota/?page={}\"","    s3_client = boto3.client(\"s3\")","    today = datetime.utcnow().strftime(\"%Y-%m-%d\")","    ","    for page in range(1, 11):  # Descargar 10 páginas","        url = BASE_URL.format(page)","        print(f\"Descargando: {url}\")","        ","        try:","            with urllib.request.urlopen(url) as response:","                html_content = response.read().decode(\"utf-8\")","                ","                file_name = f\"{today}/page_{page}.html\"","                s3_key = f\"{file_name}\"","                ","                # Subir a S3","                s3_client.put_object(","                    Bucket=S3_BUCKET,","                    Key=s3_key,","                    Body=html_content,","                    ContentType=\"text/html\"","                )","                print(f\"Guardado en S3: s3://{S3_BUCKET}/{s3_key}\")","        except Exception as e:","            print(f\"Error al procesar la página {page}: {e}\")","    ","    return {","        \"statusCode\": 200,","        \"body\": json.dumps(\"Descarga y almacenamiento completados.\")","    }",""],"id":239},{"start":{"row":0,"column":0},"end":{"row":46,"column":5},"action":"insert","lines":["import json","import urllib.request","import boto3","from datetime import datetime","","def lambda_handler(event, context):","    # Configuración del bucket S3","    ","    headers = {","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36\",","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\",","        \"Connection\": \"keep-alive\"","    }","    ","    S3_BUCKET = \"paginaspruebas\"","    BASE_URL = \"https://casas.mitula.com.co/apartaestudio/bogota/?page={}\"","    s3_client = boto3.client(\"s3\")","    today = datetime.utcnow().strftime(\"%Y-%m-%d\")","    ","    for page in range(1, 11):  # Descargar 10 páginas","        url = BASE_URL.format(page)","        print(f\"Descargando: {url}\")","        ","        try:","            req = urllib.request.Request(url, headers=headers)","            with urllib.request.urlopen(url) as response:","                html_content = response.read().decode(\"utf-8\")","                ","                file_name = f\"{today}/page_{page}.html\"","                s3_key = f\"{file_name}\"","                ","                # Subir a S3","                s3_client.put_object(","                    Bucket=S3_BUCKET,","                    Key=s3_key,","                    Body=html_content,","                    ContentType=\"text/html\"","                )","                print(f\"Guardado en S3: s3://{S3_BUCKET}/{s3_key}\")","        except Exception as e:","            print(f\"Error al procesar la página {page}: {e}\")","    ","    return {","        \"statusCode\": 200,","        \"body\": json.dumps(\"Descarga y almacenamiento completados.\")","    }"]}],[{"start":{"row":0,"column":0},"end":{"row":46,"column":5},"action":"remove","lines":["import json","import urllib.request","import boto3","from datetime import datetime","","def lambda_handler(event, context):","    # Configuración del bucket S3","    ","    headers = {","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36\",","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\",","        \"Connection\": \"keep-alive\"","    }","    ","    S3_BUCKET = \"paginaspruebas\"","    BASE_URL = \"https://casas.mitula.com.co/apartaestudio/bogota/?page={}\"","    s3_client = boto3.client(\"s3\")","    today = datetime.utcnow().strftime(\"%Y-%m-%d\")","    ","    for page in range(1, 11):  # Descargar 10 páginas","        url = BASE_URL.format(page)","        print(f\"Descargando: {url}\")","        ","        try:","            req = urllib.request.Request(url, headers=headers)","            with urllib.request.urlopen(url) as response:","                html_content = response.read().decode(\"utf-8\")","                ","                file_name = f\"{today}/page_{page}.html\"","                s3_key = f\"{file_name}\"","                ","                # Subir a S3","                s3_client.put_object(","                    Bucket=S3_BUCKET,","                    Key=s3_key,","                    Body=html_content,","                    ContentType=\"text/html\"","                )","                print(f\"Guardado en S3: s3://{S3_BUCKET}/{s3_key}\")","        except Exception as e:","            print(f\"Error al procesar la página {page}: {e}\")","    ","    return {","        \"statusCode\": 200,","        \"body\": json.dumps(\"Descarga y almacenamiento completados.\")","    }"],"id":240},{"start":{"row":0,"column":0},"end":{"row":56,"column":0},"action":"insert","lines":["import time","import boto3","from selenium import webdriver","from selenium.webdriver.chrome.service import Service","from webdriver_manager.chrome import ChromeDriverManager","from selenium.webdriver.common.by import By","","# Configurar opciones del navegador","options = webdriver.ChromeOptions()","options.add_argument(\"--headless\")  # Para que no se muestre la ventana","options.add_argument(\"--disable-gpu\")","options.add_argument(\"--no-sandbox\")","options.add_argument(\"--disable-dev-shm-usage\")","","# Inicializar el navegador","driver = webdriver.Chrome(service=Service(ChromeDriverManager().install()), options=options)","","# URL base con paginación","BASE_URL = \"https://casas.mitula.com.co/apartaestudio/bogota/?page={}\"","","# Configurar cliente de AWS S3","BUCKET_NAME = \"paginaspruebas\"","s3 = boto3.client(\"s3\")","","# Recorrer las páginas","for page in range(1, 11):","    url = BASE_URL.format(page)","    print(f\"Accediendo a: {url}\")","    ","    driver.get(url)","    time.sleep(5)  # Esperar que la página cargue","    ","    # Verificar si hay captcha","    if \"captcha\" in driver.page_source.lower():","        print(f\"Captcha detectado en página {page}, no se puede continuar automáticamente.\")","        continue","","    # Obtener el contenido HTML","    html_content = driver.page_source","    ","    # Guardar en un archivo temporal","    file_name = f\"pagina_{page}.html\"","    with open(file_name, \"w\", encoding=\"utf-8\") as file:","        file.write(html_content)","    ","    # Subir a S3","    try:","        s3.upload_file(file_name, BUCKET_NAME, file_name)","        print(f\"Página {page} subida exitosamente a S3.\")","    except Exception as e:","        print(f\"Error al subir la página {page} a S3: {e}\")","","# Cerrar el navegador","driver.quit()","","print(\"Proceso completado.\")",""]}],[{"start":{"row":14,"column":26},"end":{"row":15,"column":92},"action":"remove","lines":["","driver = webdriver.Chrome(service=Service(ChromeDriverManager().install()), options=options)"],"id":241}],[{"start":{"row":14,"column":26},"end":{"row":15,"column":0},"action":"insert","lines":["",""],"id":242}],[{"start":{"row":15,"column":0},"end":{"row":16,"column":0},"action":"insert","lines":["",""],"id":243}],[{"start":{"row":16,"column":0},"end":{"row":17,"column":0},"action":"insert","lines":["driver = webdriver.Chrome(options=options)",""],"id":244}],[{"start":{"row":0,"column":0},"end":{"row":58,"column":0},"action":"remove","lines":["import time","import boto3","from selenium import webdriver","from selenium.webdriver.chrome.service import Service","from webdriver_manager.chrome import ChromeDriverManager","from selenium.webdriver.common.by import By","","# Configurar opciones del navegador","options = webdriver.ChromeOptions()","options.add_argument(\"--headless\")  # Para que no se muestre la ventana","options.add_argument(\"--disable-gpu\")","options.add_argument(\"--no-sandbox\")","options.add_argument(\"--disable-dev-shm-usage\")","","# Inicializar el navegador","","driver = webdriver.Chrome(options=options)","","","# URL base con paginación","BASE_URL = \"https://casas.mitula.com.co/apartaestudio/bogota/?page={}\"","","# Configurar cliente de AWS S3","BUCKET_NAME = \"paginaspruebas\"","s3 = boto3.client(\"s3\")","","# Recorrer las páginas","for page in range(1, 11):","    url = BASE_URL.format(page)","    print(f\"Accediendo a: {url}\")","    ","    driver.get(url)","    time.sleep(5)  # Esperar que la página cargue","    ","    # Verificar si hay captcha","    if \"captcha\" in driver.page_source.lower():","        print(f\"Captcha detectado en página {page}, no se puede continuar automáticamente.\")","        continue","","    # Obtener el contenido HTML","    html_content = driver.page_source","    ","    # Guardar en un archivo temporal","    file_name = f\"pagina_{page}.html\"","    with open(file_name, \"w\", encoding=\"utf-8\") as file:","        file.write(html_content)","    ","    # Subir a S3","    try:","        s3.upload_file(file_name, BUCKET_NAME, file_name)","        print(f\"Página {page} subida exitosamente a S3.\")","    except Exception as e:","        print(f\"Error al subir la página {page} a S3: {e}\")","","# Cerrar el navegador","driver.quit()","","print(\"Proceso completado.\")",""],"id":245},{"start":{"row":0,"column":0},"end":{"row":44,"column":0},"action":"insert","lines":["import time","import boto3","import requests","from bs4 import BeautifulSoup","","# URL base con paginación","BASE_URL = \"https://casas.mitula.com.co/apartaestudio/bogota/?page={}\"","","# Configurar cliente de AWS S3","BUCKET_NAME = \"paginaspruebas\"","s3 = boto3.client(\"s3\")","","# Headers para simular un navegador real","headers = {","    \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",","    \"Referer\": \"https://casas.mitula.com.co\",","    \"Accept-Language\": \"en-US,en;q=0.9\"","}","","# Recorrer las páginas","for page in range(1, 11):","    url = BASE_URL.format(page)","    print(f\"Accediendo a: {url}\")","    ","    response = requests.get(url, headers=headers)","    if \"captcha\" in response.text.lower():","        print(f\"Captcha detectado en página {page}, no se puede continuar automáticamente.\")","        continue","    ","    html_content = response.text","    ","    # Guardar en un archivo temporal","    file_name = f\"pagina_{page}.html\"","    with open(file_name, \"w\", encoding=\"utf-8\") as file:","        file.write(html_content)","    ","    # Subir a S3","    try:","        s3.upload_file(file_name, BUCKET_NAME, file_name)","        print(f\"Página {page} subida exitosamente a S3.\")","    except Exception as e:","        print(f\"Error al subir la página {page} a S3: {e}\")","","print(\"Proceso completado.\")",""]}],[{"start":{"row":0,"column":0},"end":{"row":44,"column":0},"action":"remove","lines":["import time","import boto3","import requests","from bs4 import BeautifulSoup","","# URL base con paginación","BASE_URL = \"https://casas.mitula.com.co/apartaestudio/bogota/?page={}\"","","# Configurar cliente de AWS S3","BUCKET_NAME = \"paginaspruebas\"","s3 = boto3.client(\"s3\")","","# Headers para simular un navegador real","headers = {","    \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",","    \"Referer\": \"https://casas.mitula.com.co\",","    \"Accept-Language\": \"en-US,en;q=0.9\"","}","","# Recorrer las páginas","for page in range(1, 11):","    url = BASE_URL.format(page)","    print(f\"Accediendo a: {url}\")","    ","    response = requests.get(url, headers=headers)","    if \"captcha\" in response.text.lower():","        print(f\"Captcha detectado en página {page}, no se puede continuar automáticamente.\")","        continue","    ","    html_content = response.text","    ","    # Guardar en un archivo temporal","    file_name = f\"pagina_{page}.html\"","    with open(file_name, \"w\", encoding=\"utf-8\") as file:","        file.write(html_content)","    ","    # Subir a S3","    try:","        s3.upload_file(file_name, BUCKET_NAME, file_name)","        print(f\"Página {page} subida exitosamente a S3.\")","    except Exception as e:","        print(f\"Error al subir la página {page} a S3: {e}\")","","print(\"Proceso completado.\")",""],"id":246},{"start":{"row":0,"column":0},"end":{"row":53,"column":0},"action":"insert","lines":["import json","import urllib.request","import boto3","from datetime import datetime","","","def lambda_handler(event, context):","    # Configuración del bucket S3","    headers = {","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\",","        \"Connection\": \"keep-alive\"","    }","","    cookies = {","        \"captcha_token\": \"your_captcha_solution\"","    }","","    S3_BUCKET = \"paginaspruebas\"","    BASE_URL = \"https://casas.mitula.com.co/apartaestudio/bogota/?page={}\"","    s3_client = boto3.client(\"s3\")","    today = datetime.utcnow().strftime(\"%Y-%m-%d\")","","    for page in range(1, 11):  # Descargar 10 páginas","        url = BASE_URL.format(page)","        print(f\"Descargando: {url}\")","","        try:","            req = urllib.request.Request(url, headers=headers)","            req.add_header(\"Cookie\", f\"captcha_token={cookies['captcha_token']}\")","            ","            with urllib.request.urlopen(req) as response:","                html_content = response.read().decode(\"utf-8\")","","                file_name = f\"{today}/page_{page}.html\"","                s3_key = f\"{file_name}\"","","                # Subir a S3","                s3_client.put_object(","                    Bucket=S3_BUCKET,","                    Key=s3_key,","                    Body=html_content,","                    ContentType=\"text/html\"","                )","                print(f\"Guardado en S3: s3://{S3_BUCKET}/{s3_key}\")","        except Exception as e:","            print(f\"Error al procesar la página {page}: {e}\")","","    return {","        \"statusCode\": 200,","        \"body\": json.dumps(\"Descarga y almacenamiento completados.\")","    }",""]}],[{"start":{"row":20,"column":15},"end":{"row":20,"column":74},"action":"remove","lines":["\"https://casas.mitula.com.co/apartaestudio/bogota/?page={}\""],"id":247},{"start":{"row":20,"column":15},"end":{"row":20,"column":85},"action":"insert","lines":["BASE_URL = \"https://casas.mitula.com.co/apartaestudio/bogota/?page={}\""]}],[{"start":{"row":20,"column":4},"end":{"row":20,"column":15},"action":"remove","lines":["BASE_URL = "],"id":248}],[{"start":{"row":0,"column":0},"end":{"row":53,"column":0},"action":"remove","lines":["import json","import urllib.request","import boto3","from datetime import datetime","","","def lambda_handler(event, context):","    # Configuración del bucket S3","    headers = {","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\",","        \"Connection\": \"keep-alive\"","    }","","    cookies = {","        \"captcha_token\": \"your_captcha_solution\"","    }","","    S3_BUCKET = \"paginaspruebas\"","    BASE_URL = \"https://casas.mitula.com.co/apartaestudio/bogota/?page={}\"","    s3_client = boto3.client(\"s3\")","    today = datetime.utcnow().strftime(\"%Y-%m-%d\")","","    for page in range(1, 11):  # Descargar 10 páginas","        url = BASE_URL.format(page)","        print(f\"Descargando: {url}\")","","        try:","            req = urllib.request.Request(url, headers=headers)","            req.add_header(\"Cookie\", f\"captcha_token={cookies['captcha_token']}\")","            ","            with urllib.request.urlopen(req) as response:","                html_content = response.read().decode(\"utf-8\")","","                file_name = f\"{today}/page_{page}.html\"","                s3_key = f\"{file_name}\"","","                # Subir a S3","                s3_client.put_object(","                    Bucket=S3_BUCKET,","                    Key=s3_key,","                    Body=html_content,","                    ContentType=\"text/html\"","                )","                print(f\"Guardado en S3: s3://{S3_BUCKET}/{s3_key}\")","        except Exception as e:","            print(f\"Error al procesar la página {page}: {e}\")","","    return {","        \"statusCode\": 200,","        \"body\": json.dumps(\"Descarga y almacenamiento completados.\")","    }",""],"id":249},{"start":{"row":0,"column":0},"end":{"row":53,"column":0},"action":"insert","lines":["import json","import urllib.request","import boto3","from datetime import datetime","","","def lambda_handler(event, context):","    # Configuración del bucket S3","    headers = {","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\",","        \"Connection\": \"keep-alive\"","    }","","    cookies = {","        \"captcha_token\": \"your_captcha_solution\"","    }","","    S3_BUCKET = \"paginaspruebas\"","    BASE_URL = \"https://casas.mitula.com.co/find?operationType=sell&geoId=mitula-CO-poblacion-0000014156&text=Bogot%C3%A1%2C++%28Cundinamarca%29&page={}\"","    s3_client = boto3.client(\"s3\")","    today = datetime.utcnow().strftime(\"%Y-%m-%d\")","","    for page in range(1, 11):  # Descargar 10 páginas","        url = BASE_URL.format(page)","        print(f\"Descargando: {url}\")","","        try:","            req = urllib.request.Request(url, headers=headers)","            req.add_header(\"Cookie\", f\"captcha_token={cookies['captcha_token']}\")","            ","            with urllib.request.urlopen(req) as response:","                html_content = response.read().decode(\"utf-8\")","","                file_name = f\"{today}/page_{page}.html\"","                s3_key = f\"{file_name}\"","","                # Subir a S3","                s3_client.put_object(","                    Bucket=S3_BUCKET,","                    Key=s3_key,","                    Body=html_content,","                    ContentType=\"text/html\"","                )","                print(f\"Guardado en S3: s3://{S3_BUCKET}/{s3_key}\")","        except Exception as e:","            print(f\"Error al procesar la página {page}: {e}\")","","    return {","        \"statusCode\": 200,","        \"body\": json.dumps(\"Descarga y almacenamiento completados.\")","    }",""]}],[{"start":{"row":0,"column":0},"end":{"row":53,"column":0},"action":"remove","lines":["import json","import urllib.request","import boto3","from datetime import datetime","","","def lambda_handler(event, context):","    # Configuración del bucket S3","    headers = {","        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\",","        \"Connection\": \"keep-alive\"","    }","","    cookies = {","        \"captcha_token\": \"your_captcha_solution\"","    }","","    S3_BUCKET = \"paginaspruebas\"","    BASE_URL = \"https://casas.mitula.com.co/find?operationType=sell&geoId=mitula-CO-poblacion-0000014156&text=Bogot%C3%A1%2C++%28Cundinamarca%29&page={}\"","    s3_client = boto3.client(\"s3\")","    today = datetime.utcnow().strftime(\"%Y-%m-%d\")","","    for page in range(1, 11):  # Descargar 10 páginas","        url = BASE_URL.format(page)","        print(f\"Descargando: {url}\")","","        try:","            req = urllib.request.Request(url, headers=headers)","            req.add_header(\"Cookie\", f\"captcha_token={cookies['captcha_token']}\")","            ","            with urllib.request.urlopen(req) as response:","                html_content = response.read().decode(\"utf-8\")","","                file_name = f\"{today}/page_{page}.html\"","                s3_key = f\"{file_name}\"","","                # Subir a S3","                s3_client.put_object(","                    Bucket=S3_BUCKET,","                    Key=s3_key,","                    Body=html_content,","                    ContentType=\"text/html\"","                )","                print(f\"Guardado en S3: s3://{S3_BUCKET}/{s3_key}\")","        except Exception as e:","            print(f\"Error al procesar la página {page}: {e}\")","","    return {","        \"statusCode\": 200,","        \"body\": json.dumps(\"Descarga y almacenamiento completados.\")","    }",""],"id":251},{"start":{"row":0,"column":0},"end":{"row":52,"column":0},"action":"insert","lines":["import json","import urllib.request","import boto3","from datetime import datetime","","def lambda_handler(event, context):","    \"\"\"Función principal de Lambda para descargar páginas y guardarlas en S3.\"\"\"","    headers = {","        \"User-Agent\": (","            \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) \"","            \"AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\"","        ),","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Accept\": (","            \"text/html,application/xhtml+xml,application/xml;q=0.9,\" ","            \"image/webp,*/*;q=0.8\"","        ),","        \"Connection\": \"keep-alive\",","    }","","    cookies = {\"captcha_token\": \"your_captcha_solution\"}","    s3_bucket = \"paginaspruebas\"","    base_url = (","        \"https://casas.mitula.com.co/find?operationType=sell&geoId=\"","        \"mitula-CO-poblacion-0000014156&text=Bogot%C3%A1%2C++%28Cundinamarca%29&page={}\"","    )","    s3_client = boto3.client(\"s3\")","    today = datetime.utcnow().strftime(\"%Y-%m-%d\")","","    for page in range(1, 11):  # Descargar 10 páginas","        url = base_url.format(page)","        print(f\"Descargando: {url}\")","        try:","            req = urllib.request.Request(url, headers=headers)","            req.add_header(\"Cookie\", f\"captcha_token={cookies['captcha_token']}\")","            ","            with urllib.request.urlopen(req) as response:","                html_content = response.read().decode(\"utf-8\")","                file_name = f\"{today}/page_{page}.html\"","                s3_key = file_name","                ","                s3_client.put_object(","                    Bucket=s3_bucket,","                    Key=s3_key,","                    Body=html_content,","                    ContentType=\"text/html\",","                )","                print(f\"Guardado en S3: s3://{s3_bucket}/{s3_key}\")","        except Exception as e:","            print(f\"Error al procesar la página {page}: {e}\")","","    return {\"statusCode\": 200, \"body\": json.dumps(\"Descarga y almacenamiento completados.\")}",""]}],[{"start":{"row":0,"column":0},"end":{"row":52,"column":0},"action":"remove","lines":["import json","import urllib.request","import boto3","from datetime import datetime","","def lambda_handler(event, context):","    \"\"\"Función principal de Lambda para descargar páginas y guardarlas en S3.\"\"\"","    headers = {","        \"User-Agent\": (","            \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) \"","            \"AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\"","        ),","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Accept\": (","            \"text/html,application/xhtml+xml,application/xml;q=0.9,\" ","            \"image/webp,*/*;q=0.8\"","        ),","        \"Connection\": \"keep-alive\",","    }","","    cookies = {\"captcha_token\": \"your_captcha_solution\"}","    s3_bucket = \"paginaspruebas\"","    base_url = (","        \"https://casas.mitula.com.co/find?operationType=sell&geoId=\"","        \"mitula-CO-poblacion-0000014156&text=Bogot%C3%A1%2C++%28Cundinamarca%29&page={}\"","    )","    s3_client = boto3.client(\"s3\")","    today = datetime.utcnow().strftime(\"%Y-%m-%d\")","","    for page in range(1, 11):  # Descargar 10 páginas","        url = base_url.format(page)","        print(f\"Descargando: {url}\")","        try:","            req = urllib.request.Request(url, headers=headers)","            req.add_header(\"Cookie\", f\"captcha_token={cookies['captcha_token']}\")","            ","            with urllib.request.urlopen(req) as response:","                html_content = response.read().decode(\"utf-8\")","                file_name = f\"{today}/page_{page}.html\"","                s3_key = file_name","                ","                s3_client.put_object(","                    Bucket=s3_bucket,","                    Key=s3_key,","                    Body=html_content,","                    ContentType=\"text/html\",","                )","                print(f\"Guardado en S3: s3://{s3_bucket}/{s3_key}\")","        except Exception as e:","            print(f\"Error al procesar la página {page}: {e}\")","","    return {\"statusCode\": 200, \"body\": json.dumps(\"Descarga y almacenamiento completados.\")}",""],"id":252},{"start":{"row":0,"column":0},"end":{"row":53,"column":0},"action":"insert","lines":["import json","import urllib.request","import boto3","from datetime import datetime","","","def lambda_handler(event, context):","    \"\"\"Función principal de Lambda para descargar páginas y guardarlas en S3.\"\"\"","    headers = {","        \"User-Agent\": (","            \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) \"","            \"AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\"","        ),","        \"Accept-Language\": \"en-US,en;q=0.9\",","        \"Accept\": (","            \"text/html,application/xhtml+xml,application/xml;q=0.9,\"","            \"image/webp,*/*;q=0.8\"","        ),","        \"Connection\": \"keep-alive\",","    }","","    cookies = {\"captcha_token\": \"your_captcha_solution\"}","    s3_bucket = \"paginaspruebas\"","    base_url = (","        \"https://casas.mitula.com.co/find?operationType=sell&geoId=\"","        \"mitula-CO-poblacion-0000014156&text=Bogot%C3%A1%2C++%28Cundinamarca%29&page={}\"","    )","    s3_client = boto3.client(\"s3\")","    today = datetime.utcnow().strftime(\"%Y-%m-%d\")","","    for page in range(1, 11):  # Descargar 10 páginas","        url = base_url.format(page)","        print(f\"Descargando: {url}\")","        try:","            req = urllib.request.Request(url, headers=headers)","            req.add_header(\"Cookie\", f\"captcha_token={cookies['captcha_token']}\")","","            with urllib.request.urlopen(req) as response:","                html_content = response.read().decode(\"utf-8\")","                file_name = f\"{today}/page_{page}.html\"","                s3_key = file_name","","                s3_client.put_object(","                    Bucket=s3_bucket,","                    Key=s3_key,","                    Body=html_content,","                    ContentType=\"text/html\",","                )","                print(f\"Guardado en S3: s3://{s3_bucket}/{s3_key}\")","        except Exception as e:","            print(f\"Error al procesar la página {page}: {e}\")","","    return {\"statusCode\": 200, \"body\": json.dumps(\"Descarga y almacenamiento completados.\")}",""]}]]},"ace":{"folds":[],"scrolltop":555,"scrollleft":0,"selection":{"start":{"row":53,"column":0},"end":{"row":53,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":39,"state":"start","mode":"ace/mode/python"}},"timestamp":1741660905408,"hash":"5c965a294b18e037517fa8a6a742c04718c63ae5"}